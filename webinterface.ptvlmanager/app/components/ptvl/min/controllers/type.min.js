define(["./../../controllers/ptvl"],function(e){e.controller("typeCtrl",["$scope","$templateCache","lockFactory","ruleFactory",function(e,n,l,t){for(var a="directory playlist plugin rss tv-genre tv-studio youtube".split(" "),c=0;c<a.length;c++)n.get("app/components/ptvl/templates/channel-types/"+a[c]+".html");n.get("app/components/ptvl/templates/channel-details/sort-limit.html"),n.get("app/components/ptvl/templates/channel-details/sub-rules.html"),l.addLock({channel:e.channel.channel,locked:!0}),e.channel.locked=l.getLocked(e.channel.channel),e.channelLocked="Unlock",e.types=t.getTypes(),e.type={},e.changed={type:!1,saved:!0},e.changes={},e.lock=function(n){e.channel.locked?(n=confirm("Are you sure you want to "+e.channelLocked.toLowerCase()+" channel "+n.channel+"?"),1==n&&(e.channelLocked="Lock",e.channel.locked=l.toggleLock(e.channel.channel))):e.channel.locked||(n=confirm("Are you sure you want to "+e.channelLocked.toLowerCase()+" channel "+n.channel),1==n&&(e.channelLocked="Unlock",e.channel.locked=l.toggleLock(e.channel.channel)))},e.channel.type=t.getType(e.channel.type),e.selectType=function(n){e.channel.type.name==n.name?(1==e.changed.type&&(e.channel.type.templateUrl=e.channel.type.oldTemplateUrl,delete e.channel.type.oldTemplateUrl),e.changed.type=!1,void(e.changed.saved=!0)):(e.channel.type.oldTemplateUrl=e.channel.type.templateUrl,e.channel.type.templateUrl=n.templateUrl,e.changes.type=n,e.changed.type=!0,e.changed.saved=!1)},e.undo=function(){1==confirm("Are you sure you want to change the type back to "+e.channel.type.name+"?")&&(e.type.selected=e.channel.type,e.channel.type.templateUrl=e.channel.type.oldTemplateUrl,delete e.channel.type.oldTemplateUrl,e.changed.type=!1,e.changed.saved=!0)},e.saveType=function(){1==confirm("Are you sure you want to change the type to "+e.changes.type.name+"?")&&(alert("Make sure to actually download your new settings2.xml at the bottom!"),e.channel.rules.main[1]=e.changes.type.value,e.channel.changed="True",delete e.channel.type,e.changed.saved=!0,e.changed.type=!1,e.channel.locked=l.toggleLock(e.channel.channel),e.channelLocked="Unlock")}}])});