define(["./../../controllers/ptvl"],function(n){String.prototype.contains=function(n){return-1!=this.indexOf(n)},n.controller("channelCtrl",["$scope","$state","$http","dialogService","showList","settingsList",function(n,e,s,t,l,a){n.confirmed=!0,n.confirmed=t.confirm(),n.channels=[],n.loadingChannels=[],n.oneAtATime=!0,l.async().then(function(e){n.shows=e}),n.showContent=function(e){for(e=e.replace(RegExp("&","g"),"&amp;"),n.settingsFile=e,e=new X2JS,n.loadingChannels=e.xml_str2json(n.settingsFile),n.channelNumbers=[],e=0;e<n.loadingChannels.settings.setting.length;e++)if("undefined"!=typeof n.loadingChannels.settings.setting[e]){var s=n.loadingChannels.settings.setting[e]._id,t=n.loadingChannels.settings.setting[e]._value;if(isNaN(s.split("_")[1]))"undefined"==typeof n.channels[0]&&(n.channels[0]={channel:"Global Settings"},n.channels[0].settings={},n.channels[0].type="99"),n.channels[0].settings[s]=t;else{var l=parseInt(s.split("_")[1]),a=parseInt(s.split("_")[2]);"undefined"==typeof n.channels[l]&&(n.channelNumbers.push(s.split("_")[1]),n.channels[l]={channel:l,rules:{count:"",main:{},sub:{}}}),s.contains("rulecount")?n.channels[l].rules.count=parseInt(t):a===parseInt(a,10)?n.channels[l].rules.main[a]=t:s.contains("rule_")&&s.contains("id")?(s=s.split("_"),a=s[3],n.channels[l].rules.sub[a]={id:t,options:{}}):s.contains("opt")?(s=s.split("_"),a=s[3],n.channels[l].rules.sub[a].options[s[5]]=t):s.contains("type")?n.channels[l].type=t:s.contains("time")?n.channels[l].time=t:s.contains("changed")?n.channels[l].changed=t:12===s.split("_")[2].length?n.channels[l].reset=t:(t={id:s,value:t},n.channels[l].settings[s]=t)}}for(n.channelDetails={isOpen:!0},n.channelsLoaded=!0,e=n.channels,l=[],t=0;t<e.length;t++)e[t]&&l.push(e[t]);n.channels=l},n.clearChannels=function(){"undefined"!=n.channels&&1==confirm("Are you sure you want to load new channels?")&&e.reload()},n.saveSettings=function(){var e=[];e.push("<settings>"),n.newChannels=n.channels;var s=0,t=n.channelNumbers.length;for(void 0;t>=s;){if("undefined"!=typeof n.newChannels[s]){if("undefined"!=typeof n.newChannels[s].settings);else{var l='<setting id="Channel_'+n.newChannels[s].channel+'_type" value="'+n.newChannels[s].type.value+'" />';e.push(l)}if("undefined"!=typeof n.newChannels[s].rules){if("undefined"!=typeof n.newChannels[s].rules.main)for(l in l=1,n.newChannels[s].rules.main)if(n.newChannels[s].rules.main.hasOwnProperty(l)){var a='<setting id="Channel_'+n.newChannels[s].channel+"_"+l+'" value="'+n.newChannels[s].rules.main[l]+'" />';e.push(a),++l}if("undefined"!=typeof n.newChannels[s].rules.count&&(l='<setting id="Channel_'+n.newChannels[s].channel+'_rulecount" value="'+n.newChannels[s].rules.count+'" />',e.push(l)),"undefined"!=typeof n.newChannels[s].rules.sub)for(l in l=1,n.newChannels[s].rules.sub)if(n.newChannels[s].rules.sub.hasOwnProperty(l)){a='<setting id="Channel_'+n.newChannels[s].channel+"_rule_"+l+'_id" value="'+n.newChannels[s].rules.sub[l].id+'" />',e.push(a),a=1;for(a in n.newChannels[s].rules.sub[l].options)if(n.newChannels[s].rules.sub[l].options.hasOwnProperty(a)){var i='<setting id="Channel_'+n.newChannels[s].channel+"_rule_"+l+"_opt_"+a+'" value="'+n.newChannels[s].rules.sub[l].options[a]+'" />';e.push(i),++a}++l}}"undefined"!=typeof n.newChannels[s].changed&&(l='<setting id="Channel_'+n.newChannels[s].channel+'_changed" value="'+n.newChannels[s].changed+'" />',e.push(l)),"undefined"!=typeof n.newChannels[s].time&&(l='<setting id="Channel_'+n.newChannels[s].channel+'_time" value="'+n.newChannels[s].time+'" />',e.push(l)),"undefined"!=typeof n.newChannels[s].reset&&(l='<setting id="Channel_'+n.newChannels[s].channel+'_SetResetTime" value="'+n.newChannels[s].reset+'" />',e.push(l))}s++}"undefined"!=typeof n.newChannels[0]&&"undefined"!=typeof n.newChannels[0].settings&&("undefined"!=typeof n.newChannels[0].settings.LastExitTime&&e.push('<setting id="LastExitTime" value="'+n.newChannels[0].settings.LastExitTime+'" />'),"undefined"!=typeof n.newChannels[0].settings.LastResetTime&&e.push('<setting id="LastResetTime" value="'+n.newChannels[0].settings.LastResetTime+'" />'),"undefined"!=typeof n.newChannels[0].settings.ForceChannelReset&&e.push('<setting id="ForceChannelReset" value="'+n.newChannels[0].settings.ForceChannelReset+'" />')),e.push("</settings>"),e=e.join(""),e=new Blob([e],{type:"text/plain"}),saveAs(e,"settings2.xml")},n.log=function(n){}}])});